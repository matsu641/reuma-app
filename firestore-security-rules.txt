//
// Firestore セキュリティルール
// Firebase Console > Firestore Database > ルール タブに貼り付けてください
//

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ユーザー認証が必要
    match /users/{userId} {
      // ユーザー自身のドキュメントのみアクセス可能
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // サブコレクションへのアクセス
      match /{subcollection=**} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      // 食事記録への特別なアクセス制御（念のため明示的に定義）
      match /foodLogs/{foodLogId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
  }
}
